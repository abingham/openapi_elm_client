module Client exposing (..)

import Json.Decode
import Json.Decode.Pipeline

-- Typedefs

{% for type_name, obj_def in typedefs.items() %}
type alias {{ type_name }} = 
{% for property_name, property_def in obj_def.properties.items() %}
    {% if loop.first %}{ {% else %}, {% endif %}{{ property_name | camel_case }}: {{ property_def | type_name }}
{% endfor %}
    }

{% endfor %}

-- Decoders

{% for type_name, obj_def in typedefs.items() %}
{{ type_name }}Decoder : Json.Decode.Decoder {{ type_name }}
{{ type_name }}Decoder = 
    Json.Decode.success {{ type_name }}
{% for property_name, property_def in obj_def.properties.items() %}
    {% if property_def.required %}
        |> Json.Decode.Pipeline.required "{{ property_name }}" {{ property_def.typedef | json_decoder }}
    {% else %}
        |> Json.Decode.Pipeline.optional "{{ property_name }}" (Json.Decode.nullable {{ property_def.typedef | json_decoder }}) Nothing
    {% endif %}
{% endfor %}

{% endfor %}

